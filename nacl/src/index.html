<!DOCTYPE html>
<html>
<head>

<title>Snygg</title>

<link href='https://fonts.googleapis.com/css?family=Marcellus' rel='stylesheet' type='text/css'>
<link rel='stylesheet' type='text/css' href='http://magnushoff.com/style.css'></link>
<style>

.progressbar {
	display: inline-block;
	width: 50px;
	height: 4px;
	border-radius: 4px;
	border: 1px solid #4c66b2;
	overflow: hidden;
	vertical-align: middle;
}
.progress {
	display: block;
	background: #4c66b2;
	height: 100%;
}

.snygg {
	width: 100%;
	height: 540px;
}

</style>

<script>

function installApp() {
	var snygg = document.getElementById("snygg");

	snygg.addEventListener('loadstart', function () {
		document.getElementById('statusField').textContent = "loading...";
	});

	snygg.addEventListener('progress', function (ev) {
		var status = "loading";
		if (ev.lengthComputable) {
			var progressPercentage = ev.loaded / ev.total * 100;
			status = "loading<br/><span class='progressbar'><span class='progress' style='width: " + progressPercentage + "%'></span></span>";
		}
		document.getElementById('statusField').innerHTML = status;
	});

	snygg.addEventListener('load', function () {
		document.getElementById('statusField').textContent = "loading";
	});

	function displayLastError() {
		document.getElementById('statusField').textContent = snygg.lastError;
	}

	snygg.addEventListener('error', displayLastError);
	snygg.addEventListener('abort', displayLastError);

	snygg.addEventListener('crash', function () {
		var status;
		if (snygg.exitStatus === 0) status = "finished";
		else status = "crashed with exit code " + snygg.exitStatus;
		document.getElementById('statusField').textContent = status;
	});

	snygg.addEventListener('message', function (ev) {
		var msg = JSON.parse(ev.data);
		if (msg.status === "running") {
			document.getElementById('statusField').innerHTML = "&nbsp;";
		}
	});
}

document.addEventListener("DOMContentLoaded", installApp);

</script>

</head>
<body>

<div class="content">

<h1>Snygg</h1>

<div class="subheading" id="statusField"></div>

<embed
	id="snygg"
	src="platform-pnacl.nmf"
	type="application/x-pnacl"
	board="pill"
	class="snygg"
></embed>

</div>

</body>
</html>
