<!DOCTYPE html>
<html>
<head>

<title>Snygg</title>

<style>

#out .floor {
	stroke: none;
}

.progressbar {
	display: inline-block;
	width: 50px;
	height: 15px;
	border-radius: 5px;
	border: 1px solid #ccc;
	overflow: hidden;
	vertical-align: middle;
}
.progress {
	display: block;
	background: #4c66b2;
	height: 100%;
}

</style>

<script>

function installApp() {
	var snygg = document.getElementById("snygg");

	snygg.addEventListener('loadstart', function () {
		document.getElementById('statusField').textContent = "loading...";
	});

	snygg.addEventListener('progress', function (ev) {
		var status = "loading...";
		if (ev.lengthComputable) {
			var progressPercentage = ev.loaded / ev.total * 100;
			status = "loading <span class='progressbar'><span class='progress' style='width: " + progressPercentage + "%'></span></span>";
		}
		document.getElementById('statusField').innerHTML = status;
	});

	snygg.addEventListener('load', function () {
		document.getElementById('statusField').textContent = "running";
	});

	function displayLastError() {
		document.getElementById('statusField').textContent = snygg.lastError;
	}

	snygg.addEventListener('error', displayLastError);
	snygg.addEventListener('abort', displayLastError);

	snygg.addEventListener('crash', function () {
		var status;
		if (snygg.exitStatus === 0) status = "finished";
		else status = "crashed with exit code " + snygg.exitStatus;
		document.getElementById('statusField').textContent = status;
	});

	var buf = "";
	snygg.addEventListener('message', function (ev) {
		buf += ev.data;
		document.getElementById('out').innerHTML = buf;
	});
}

document.addEventListener("DOMContentLoaded", installApp);

</script>

</head>
<body>

<h1>Snygg</h1>

<dl><dt>Status</dt><dd id="statusField"></dd></dl>

<div id="out"></div>

<embed
	id="snygg"
	width="200" height="200"
	src="platform-pnacl.nmf"
	type="application/x-pnacl"
	ps_stdout="dev/tty"
	ps_tty_prefix=""
	arg0="pill"
></embed>

</body>
</html>
