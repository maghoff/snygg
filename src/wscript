#!/bin/env python
# -*- coding: utf-8 -*-

def build(bld):
	import platform

	lib_name_pattern = '%s'
	platform_libs = []

	if platform.system() == 'Windows':
		# waf names static libraries differently on windows for a misguided reason
		lib_name_pattern = 'lib%s'
		platform_libs.append('User32')

	bld.add_subdirs([
		'skin',
		'segment',
		'core',
	])

	sources = [
		'player.cpp',
		'snake_direction_listener.cpp',

		'platform-desktop-sdl/main.cpp',
		'platform-desktop-sdl/paths.cpp',
		'platform-desktop-sdl/snygg.cpp',

		'game/food_generator.cpp',
		'game/food_item.cpp',
		'game/item.cpp',
		'game/item_container.cpp',
		'game/item_with_life.cpp',
		'game/snake.cpp',
		'game/digesting_growth_policy.cpp',
		'game/growth_policy.cpp',
		'game/immediate_growth_policy.cpp',

		'board/board.cpp',
		'board/complex_polygon_triangulator.cpp',
		'board/complex_polygon_triangulator_gpc.cpp',
		'board/lua_vm.cpp',
		'board/segment_heap.cpp',
		'board/gpc/gpc.c',

		'../external/downloads/luabind-0.9.1/src/class.cpp',
		'../external/downloads/luabind-0.9.1/src/class_info.cpp',
		'../external/downloads/luabind-0.9.1/src/class_registry.cpp',
		'../external/downloads/luabind-0.9.1/src/class_rep.cpp',
		'../external/downloads/luabind-0.9.1/src/create_class.cpp',
		'../external/downloads/luabind-0.9.1/src/error.cpp',
		'../external/downloads/luabind-0.9.1/src/exception_handler.cpp',
		'../external/downloads/luabind-0.9.1/src/function.cpp',
		'../external/downloads/luabind-0.9.1/src/inheritance.cpp',
		'../external/downloads/luabind-0.9.1/src/link_compatibility.cpp',
		'../external/downloads/luabind-0.9.1/src/object_rep.cpp',
		'../external/downloads/luabind-0.9.1/src/open.cpp',
		'../external/downloads/luabind-0.9.1/src/pcall.cpp',
		'../external/downloads/luabind-0.9.1/src/scope.cpp',
		'../external/downloads/luabind-0.9.1/src/stack_content_by_name.cpp',
		'../external/downloads/luabind-0.9.1/src/weak_ref.cpp',
		'../external/downloads/luabind-0.9.1/src/wrapper_base.cpp',
	]

	obj = bld.program(
		source=sources,
		target='snygg',
		use=[
			'ymse',
			'GL',
			'glew',
			'SDL',
			'SDLmain',
			'SDL_image',
			'boost',
			'lua',
			'luabind',
			'imlib',

			'skin',
			'segment',
			'core',
		],
		lib=[lib_name_pattern % 'boost_filesystem', lib_name_pattern % 'boost_system'] + platform_libs,
		includes=[],
	)
